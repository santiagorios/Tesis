<%= tinymce_assets %>
<%= simple_nested_form_for @entry, :validate => true, :html => { :class => 'form-horizontal' } do |f| %>
  <% if @entry.errors.any? %>
  <div class="alert">
    <button class="close" data-dismiss="alert">x</button>
    <strong><%= t('application.warning') %></strong> <%= t('entry.could_not_create', :count => @entry.errors.count) %>
  </div>
  <% end %>

  <%= f.input :title, :input_html => { :class => 'span7' } %>
  <%= f.input :date, :as => :string, :input_html => { :class => 'span7' } %>

  <div class="control-group">
    <label class="control-label"><%= t('entry.research_lines') %></label>
    <div class="controls">
      <%= content_tag :ul, :class => "span7", :id => "research-lines", data: {autocomplete_source: ResearchLine.order(:name).map(&:name)}  do %>
        <% for research_line in @entry.research_lines %>
          <li><%= research_line.name %></li>
        <% end %>
      <% end %>
    </div>
  </div>

  <%= f.input :published %>

  <div class="entry-images controls span7">
    <%= f.fields_for :images do |image_form| %>
      <div class="well">
        <h4>Image</h4>
        <%= image_form.input :title %>
        
        <div class="control-group">
          <div class="controls">
            <div class="fileupload fileupload-new" data-fileupload="image"><input type="hidden">
              <div class="fileupload-new thumbnail" style="max-width: 200px; max-height: 150px;">
                <img src="<%= (image_form.object.image_url.present?)? image_form.object.image_url : "http://www.placehold.it/200x150/EFEFEF/&text=no+image"  %>">
              </div>
              <div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 200px; max-height: 150px; line-height: 0px; "></div>
              <div>
                <span class="btn btn-file">
                  <span class="fileupload-new">Select image</span>
                  <span class="fileupload-exists">Change</span>
                  <%= image_form.input_field :image %>
                </span>
                <a href="#" class="btn fileupload-exists" data-dismiss="fileupload">Remove</a>
              </div>
            </div>
          </div>
        </div>
        
        <div class="control-group">
          <div class="controls">
            <%= image_form.link_to_remove "Remove this image" %>
          </div>
        </div>
      </div>
    <% end %>
    <%= f.link_to_add "Add an image", :images, :class => "add-image-link" %>
  </div>

  <%= f.input :body, :input_html => { :class => 'tinymce span7' } %>
  <%= tinymce %>

  <div class="form-actions">
    <div class="pull-right">
      <%= f.submit nil, :class => 'btn btn-primary' %>
      <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                  entries_path, :class => 'btn' %>
    </div>
  </div>
<% end %>
